
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta content="Learn how to mitigate quantum circuits using Mitiq and PennyLane. " property="og:description" />
<meta content="https://pennylane.ai/qml/_images/laptop.png" property="og:image" />

  <link rel="icon" type="image/x-icon" href="../_static/favicon.ico">
  <link rel="shortcut icon" type="image/x-icon" href="../_static/favicon.ico">
  


  <meta property="og:title" content="Error mitigation with Mitiq and PennyLane &#8212; PennyLane">
  <meta property="og:url" content="https://pennylane.ai/qml/demos/tutorial_error_mitigation.html">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">

  
  
  <meta content="Learn how to mitigate quantum circuits using Mitiq and PennyLane. " property="og:description" />
  

  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto&display=swap">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
  <!-- Material Design Bootstrap -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.14/css/mdb.min.css">
  <!-- NanoScroller -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.nanoscroller/0.8.7/css/nanoscroller.min.css">
  <!-- Syntax Highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/tomorrow-night.min.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       "HTML-CSS": { scale: 90, linebreaks: { automatic: true } },
       TeX: {
         Macros: {
           pr : ['|\#1\\rangle\\langle\#1|',1],
           ket: ['\\left| \#1\\right\\rangle',1],
           bra: ['\\left\\langle \#1\\right|',1],
           xket: ['\\left| \#1\\right\\rangle_x',1],
           xbra: ['\\left\\langle \#1\\right|_x',1],
           braket: ['\\langle \#1 \\rangle',1],
           braketD: ['\\langle \#1 \\mid \#2 \\rangle',2],
           braketT: ['\\langle \#1 \\mid \#2 \\mid \#3 \\rangle',3],
           ketbra: ['| #1 \\rangle \\langle #2 |',2],
           hc: ['\\text{h.c.}',0],
           cc: ['\\text{c.c.}',0],
           h: ['\\hat',0],
           nn: ['\\nonumber',0],
           di: ['\\frac{d}{d \#1}',1],
           uu: ['\\mathcal{U}',0],
           inn: ['\\text{in}',0],
           out: ['\\text{out}',0],
           vac: ['\\text{vac}',0],
           I: ['\\hat{\\mathbf{1}}',0],
           x: ['\\hat{x}',0],
           p: ['\\hat{p}',0],
           a: ['\\hat{a}',0],
           ad: ['\\hat{a}^\\dagger',0],
           n: ['\\hat{n}',0],
           nbar: ['\\overline{n}',0],
           sech: ['\\mathrm{sech~}',0],
           tanh: ['\\mathrm{tanh~}',0],
           re: ['\\text{Re}',0],
           im: ['\\text{Im}',0],
           tr: ['\\mathrm{Tr} #1',1],
           sign: ['\\text{sign}',0],
           overlr: ['\\overset\\leftrightarrow{\#1}',1],
           overl: ['\\overset\leftarrow{\#1}',1],
           overr: ['\\overset\rightarrow{\#1}',1],
           avg: ['\\left< \#1 \\right>',1],
           slashed: ['\\cancel{\#1}',1],
           bold: ['\\boldsymbol{\#1}',1],
           d: ['\\mathrm d',0],
           expect: ["\\langle #1 \\rangle",1],
           pde: ["\\frac{\\partial}{\\partial \#1}",1],
           R: ["\\mathbb{R}",0],
           C: ["\\mathbb{C}",0],
           Ad: ["\\text{Ad}",0],
           Var: ["\\text{Var}",0],
           bx: ["\\mathbf{x}", 0],
           bm: ["\\boldsymbol{\#1}",1],
           haf: ["\\mathrm{haf}",0],
           lhaf: ["\\mathrm{lhaf}",0]
         }
       }
     });
     </script>

  <!-- Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130507810-1"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-130507810-1');
      </script>
  
    <title>Error mitigation with Mitiq and PennyLane &#8212; PennyLane  documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/xanadu.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/light-slider.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/hubs.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <link rel="canonical" href="https://pennylane.ai/qml/demos/tutorial_error_mitigation.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Quantum computing with superconducting qubits" href="tutorial_sc_qubits.html" />
    <link rel="prev" title="Trapped ion quantum computers" href="tutorial_trapped_ions.html" /> 
  </head><body><nav class="navbar navbar-expand-lg navbar-light white sticky-top">

<!-- Logo and Title -->









  



  <a class="navbar-brand nav-link" href="https://pennylane.ai">
    
  <img class="pr-1" src=" ../_static/logo.png" width="28px"></img>
  
    <img id="navbar-wordmark" src="../_static/pennylane.svg"></img>
  
  </a>


  <!-- [Mobile] Collapse Button -->
  <div class="row right">
    

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#basicExampleNav"
      aria-controls="basicExampleNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>

  <!-- [Mobile] Collapsible Content -->
  <div class="collapse navbar-collapse" id="basicExampleNav">

    <!-- Links on the Left -->
    <ul class="navbar-nav mr-auto">
      
        
          
            <li class="nav-item active">
              <a class="nav-link" href="https://pennylane.ai/qml/">
                
  
    Learn
  

              </a>
              <span class="sr-only">(current)</span>
            </li>
          

        
      
        
          <li class="nav-item">
            <a class="nav-link" href="https://pennylane.ai/qml/demonstrations.html">
                
  
    Demos
  

            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="https://pennylane.ai/install.html">
                
  
    Install
  

            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="https://pennylane.ai/plugins.html">
                
  
    Plugins
  

            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="https://docs.pennylane.ai">
                
  
    Documentation
  

            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a class="nav-link" href="https://pennylane.ai/blog/">
                
  
    Blog
  

            </a>
          </li>
        
      
    </ul>

    <!-- Links on the Right -->
    <ul class="navbar-nav ml-auto nav-flex-icons">
      
        <li class="nav-item">
          <a class="nav-link" href="https://pennylane.ai/faq.html">
            <i class="fas fa-question pr-1"></i> FAQ
          </a>
        </li>
      
        <li class="nav-item">
          <a class="nav-link" href="https://discuss.pennylane.ai/">
            <i class="fab fa-discourse pr-1"></i> Support
          </a>
        </li>
      
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/PennyLaneAI/pennylane">
            <i class="fab fa-github pr-1"></i> GitHub
          </a>
        </li>
      

    </ul>
  </div>

</nav>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tutorial_sc_qubits.html" title="Quantum computing with superconducting qubits"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial_trapped_ions.html" title="Trapped ion quantum computers"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">PennyLane  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../demonstrations.html" >Demos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../demos_quantum-computing.html" accesskey="U">Quantum Computing</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Error mitigation with Mitiq and PennyLane</a></li> 
      </ul>
    </div>
    <div class="container-wrapper">
        <div id="content">
          <div id="right-column">
            
            

            <div class="document clearer body">
              
    <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-demos-tutorial-error-mitigation-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="error-mitigation-with-mitiq-and-pennylane">
<span id="sphx-glr-demos-tutorial-error-mitigation-py"></span><h1>Error mitigation with Mitiq and PennyLane<a class="headerlink" href="#error-mitigation-with-mitiq-and-pennylane" title="Permalink to this headline">¶</a></h1>
<p><script type="text/javascript">
    var related_tutorials = ["tutorial_chemical_reactions.html", "tutorial_noisy_circuits.html"];
    var related_tutorials_titles = ['Modelling chemical reactions on a quantum computer', 'Noisy circuits'];
</script></p>
<p><em>Authors: Tom Bromley (PennyLane) and Andrea Mari (Mitiq) — Posted: 29 November 2021. Last updated: 29 November 2021.</em></p>
<p>Have you ever run a circuit on quantum hardware and not quite got the result you were expecting?
If so, welcome to the world of noisy intermediate-scale quantum (NISQ) devices! These devices must
function in noisy environments and are unable to execute quantum circuits perfectly, resulting in
outputs that can have a significant error. The long-term plan of quantum computing is to develop a
subsequent generation of error-corrected hardware. In the meantime, how can we best utilize our
error-prone NISQ devices for practical tasks? One proposed solution is to adopt an approach called
error <em>mitigation</em>, which aims to minimize the effects of noise by executing a family of related
circuits and using the results to estimate an error-free value.</p>
<div class="figure align-center">
<a class="reference external image-reference" href="javascript:void(0);"><img alt="Mitiq and PennyLane" src="../_images/laptop.png" style="width: 441.65000000000003px; height: 364.65000000000003px;" /></a>
</div>
<p>This demo shows how error mitigation can be carried out by combining PennyLane with the
<a class="reference external" href="https://github.com/unitaryfund/mitiq">Mitiq</a> package, a Python-based library providing a range
of error mitigation techniques. Integration with PennyLane is available from the <code class="docutils literal notranslate"><span class="pre">0.11</span></code> version
of Mitiq, which can be installed using</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;mitiq&gt;=0.11&quot;</span>
</pre></div>
</div>
<p>We’ll begin the demo by jumping straight into the deep end and seeing how to mitigate a simple noisy
circuit in PennyLane with Mitiq as a backend. After, we’ll take a step back and discuss the theory
behind the error mitigation approach we used, known as zero-noise extrapolation. Using this
knowledge, we’ll give a more detailed explanation of how error mitigation can be carried out in
PennyLane. The final part of
this demo showcases the application of mitigation to quantum chemistry, allowing us to more
accurately calculate the potential energy surface of molecular hydrogen.</p>
<div class="section" id="mitigating-noise-in-a-simple-circuit">
<h2>Mitigating noise in a simple circuit<a class="headerlink" href="#mitigating-noise-in-a-simple-circuit" title="Permalink to this headline">¶</a></h2>
<p>We first need a noisy device to execute our circuit on. Let’s keep things simple for now by loading
the <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.devices.default_mixed.html#module-pennylane.devices.default_mixed" title="(in PennyLane v0.31)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">default.mixed</span></code></a> simulator and artificially adding
<a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PhaseDamping.html#pennylane.PhaseDamping" title="(in PennyLane v0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PhaseDamping</span></code></a> noise.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pennylane</span> <span class="k">as</span> <span class="nn">qml</span>

<span class="n">n_wires</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># Describe noise</span>
<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PhaseDamping.html#pennylane.PhaseDamping" title="pennylane.PhaseDamping" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">noise_gate</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PhaseDamping.html#pennylane.PhaseDamping" title="pennylane.PhaseDamping" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PhaseDamping</span></a>
<span class="n">noise_strength</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># Load devices</span>
<span class="n">dev_ideal</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.device.html#pennylane.device" title="pennylane.device" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">device</span></a><span class="p">(</span><span class="s2">&quot;default.mixed&quot;</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="n">n_wires</span><span class="p">)</span>
<span class="n">dev_noisy</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.transforms.insert.html#pennylane.transforms.insert" title="pennylane.transforms.insert" class="sphx-glr-backref-module-pennylane-transforms sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">insert</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PhaseDamping.html#pennylane.PhaseDamping" title="pennylane.PhaseDamping" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">noise_gate</span></a><span class="p">,</span> <span class="n">noise_strength</span><span class="p">)(</span><span class="n">dev_ideal</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above, we load a noise-free device <code class="docutils literal notranslate"><span class="pre">dev_ideal</span></code> and a noisy device <code class="docutils literal notranslate"><span class="pre">dev_noisy</span></code>, which
is constructed from the <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.transforms.insert.html#pennylane.transforms.insert" title="(in PennyLane v0.31)"><code class="xref py py-func docutils literal notranslate"><span class="pre">qml.transforms.insert</span></code></a> transform.
This transform works by intercepting each circuit executed on the device and adding the
<a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PhaseDamping.html#pennylane.PhaseDamping" title="(in PennyLane v0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PhaseDamping</span></code></a> noise channel directly after every gate in the
circuit. To get a better understanding of noise channels like
<a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PhaseDamping.html#pennylane.PhaseDamping" title="(in PennyLane v0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PhaseDamping</span></code></a>, check out the <a class="reference internal" href="tutorial_noisy_circuits.html"><span class="doc">Noisy circuits</span></a>
tutorial.</p>
<p>The next step is to define our circuit. Inspired by the mirror circuits concept introduced by
Proctor <em>et al.</em> <a class="footnote-reference brackets" href="#proctor2020measuring" id="id1">1</a> let’s fix a circuit that applies a unitary <span class="math notranslate nohighlight">\(U\)</span>
followed by its inverse <span class="math notranslate nohighlight">\(U^{\dagger}\)</span>, with <span class="math notranslate nohighlight">\(U\)</span> given by the
<a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.SimplifiedTwoDesign.html#pennylane.SimplifiedTwoDesign" title="(in PennyLane v0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimplifiedTwoDesign</span></code></a>
template. We also fix a measurement of the <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliZ.html#pennylane.PauliZ" title="(in PennyLane v0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PauliZ</span></code></a> observable on our
first qubit. Importantly, such a circuit performs an identity transformation
<span class="math notranslate nohighlight">\(U^{\dagger} U |\psi\rangle = |\psi\rangle\)</span> to any input state <span class="math notranslate nohighlight">\(|\psi\rangle\)</span> and we
can show that the expected value of an ideal circuit execution with an input state
<span class="math notranslate nohighlight">\(|0\rangle\)</span> is</p>
<div class="math notranslate nohighlight">
\[\langle 0 | U U^{\dagger} Z U^{\dagger} U | 0 \rangle = 1.\]</div>
<p>Although this circuit seems trivial, it provides an ideal test case for benchmarking noisy
devices where we expect the output to be less than one due to the detrimental effects of noise.
Let’s check this out in PennyLane code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pennylane</span> <span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1967</span><span class="p">)</span>

<span class="c1"># Select template to use within circuit and generate parameters</span>
<span class="n">n_layers</span> <span class="o">=</span> <span class="mi">1</span>
<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.SimplifiedTwoDesign.html#pennylane.SimplifiedTwoDesign" title="pennylane.SimplifiedTwoDesign" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">template</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.SimplifiedTwoDesign.html#pennylane.SimplifiedTwoDesign" title="pennylane.SimplifiedTwoDesign" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">SimplifiedTwoDesign</span></a>
<span class="n">weights_shape</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.SimplifiedTwoDesign.html#pennylane.SimplifiedTwoDesign" title="pennylane.SimplifiedTwoDesign" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">template</span></a><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">n_layers</span><span class="p">,</span> <span class="n">n_wires</span><span class="p">)</span>
<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">weights_shape</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">circuit</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a><span class="p">):</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.SimplifiedTwoDesign.html#pennylane.SimplifiedTwoDesign" title="pennylane.SimplifiedTwoDesign" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">template</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">))</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.adjoint.html#pennylane.adjoint" title="pennylane.adjoint" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">adjoint</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.SimplifiedTwoDesign.html#pennylane.SimplifiedTwoDesign" title="pennylane.SimplifiedTwoDesign" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">template</span></a><span class="p">)(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">))</span>
    <span class="k">return</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.expval.html#pennylane.expval" title="pennylane.expval" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">expval</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliZ.html#pennylane.PauliZ" title="pennylane.PauliZ" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliZ</span></a><span class="p">(</span><span class="mi">0</span><span class="p">))</span>


<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ideal_qnode</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">QNode</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">circuit</span></a><span class="p">,</span> <span class="n">dev_ideal</span><span class="p">)</span>
<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">noisy_qnode</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">QNode</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">circuit</span></a><span class="p">,</span> <span class="n">dev_noisy</span><span class="p">)</span>
</pre></div>
</div>
<p>First, we’ll visualize the circuit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.draw.html#pennylane.draw" title="pennylane.draw" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">draw</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ideal_qnode</span></a><span class="p">,</span> <span class="n">expansion_strategy</span><span class="o">=</span><span class="s2">&quot;device&quot;</span><span class="p">)(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>0: ──RY(4.56)─╭●──RY(5.93)──RY(-5.93)────────────────────────────────────╭●──RY(-4.56)─┤  &lt;Z&gt;
1: ──RY(3.60)─╰Z──RY(5.90)─╭●──────────RY(5.18)──RY(-5.18)─╭●──RY(-5.90)─╰Z──RY(-3.60)─┤
2: ──RY(4.05)─╭●──RY(3.32)─╰Z──────────RY(1.07)──RY(-1.07)─╰Z──RY(-3.32)─╭●──RY(-4.05)─┤
3: ──RY(3.51)─╰Z──RY(3.66)──RY(-3.66)────────────────────────────────────╰Z──RY(-3.51)─┤
</pre></div>
</div>
<p>As expected, executing the circuit on an ideal noise-free device gives a result of <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ideal_qnode</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>tensor(1., requires_grad=True)
</pre></div>
</div>
<p>On the other hand, we obtain a noisy result when running on <code class="docutils literal notranslate"><span class="pre">dev_noisy</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">noisy_qnode</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>tensor(0.71729164, requires_grad=True)
</pre></div>
</div>
<p>So, we have set ourselves up with a benchmark circuit and seen that executing on a noisy device
gives imperfect results. Can the results be improved? Time for error mitigation! We’ll first
show how easy it is to add error mitigation in PennyLane with Mitiq as a backend, before
explaining what is going on behind the scenes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run the code below you will need to have the Qiskit plugin installed. This plugin can be
installed using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>pennylane-qiskit
</pre></div>
</div>
<p>The Qiskit plugin is required to convert our PennyLane circuits to OpenQASM 2.0, which is used
as an intermediate representation when working with Mitiq.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mitiq.zne.scaling</span> <span class="kn">import</span> <span class="n">fold_global</span>
<span class="kn">from</span> <span class="nn">mitiq.zne.inference</span> <span class="kn">import</span> <span class="n">RichardsonFactory</span>
<span class="kn">from</span> <span class="nn">pennylane.transforms</span> <span class="kn">import</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.batch_transform.html#pennylane.batch_transform" title="pennylane.batch_transform" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mitigate_with_zne</span></a>

<span class="n">extrapolate</span> <span class="o">=</span> <span class="n">RichardsonFactory</span><span class="o">.</span><span class="n">extrapolate</span>
<span class="n">scale_factors</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">mitigated_qnode</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.batch_transform.html#pennylane.batch_transform" title="pennylane.batch_transform" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mitigate_with_zne</span></a><span class="p">(</span><span class="n">scale_factors</span><span class="p">,</span> <span class="n">fold_global</span><span class="p">,</span> <span class="n">extrapolate</span><span class="p">)(</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">noisy_qnode</span></a>
<span class="p">)</span>
<span class="n">mitigated_qnode</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>0.8985196547410824
</pre></div>
</div>
<p>Amazing! Using PennyLane’s <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.transforms.mitigate_with_zne.html#pennylane.transforms.mitigate_with_zne" title="(in PennyLane v0.31)"><code class="xref py py-func docutils literal notranslate"><span class="pre">mitigate_with_zne</span></code></a>
transform, we can create a new <code class="docutils literal notranslate"><span class="pre">mitigated_qnode</span></code> whose result is closer to the ideal noise-free
value of <code class="docutils literal notranslate"><span class="pre">1</span></code>. How does this work?</p>
</div>
<div class="section" id="understanding-error-mitigation">
<h2>Understanding error mitigation<a class="headerlink" href="#understanding-error-mitigation" title="Permalink to this headline">¶</a></h2>
<p>Error mitigation can be realized through a number of techniques, and the Mitiq
<a class="reference external" href="https://mitiq.readthedocs.io/en/stable/">documentation</a> is a great resource to start learning
more. In this demo, we focus upon the zero-noise extrapolation (ZNE) method originally
introduced by Temme et al. <a class="footnote-reference brackets" href="#temme2017error" id="id2">2</a> and Li et al. <a class="footnote-reference brackets" href="#li2017efficient" id="id3">3</a>.</p>
<p>The ZNE method works by assuming that the amount of noise present when a circuit is run on a
noisy device is enumerated by a parameter <span class="math notranslate nohighlight">\(\gamma\)</span>. Suppose we have an input circuit
that experiences an amount of noise <span class="math notranslate nohighlight">\(\gamma = \gamma_{0}\)</span> when executed.
Ideally, we would like to evaluate the result of the circuit in the <span class="math notranslate nohighlight">\(\gamma = 0\)</span>
noise-free setting.</p>
<p>To do this, we create a family of equivalent circuits whose ideal noise-free value is the
same as our input circuit. However, when run on a noisy device, each circuit experiences
an amount of noise <span class="math notranslate nohighlight">\(\gamma = s \gamma_{0}\)</span> for some scale factor <span class="math notranslate nohighlight">\(s \ge 1\)</span>. By
evaluating the noisy outputs of each circuit, we can extrapolate to <span class="math notranslate nohighlight">\(s=0\)</span> to estimate
the result of running a noise-free circuit.</p>
<p>A key element of ZNE is the ability to run equivalent circuits for a range of scale factors
<span class="math notranslate nohighlight">\(s\)</span>. When the noise present in a circuit scales with the number of gates, <span class="math notranslate nohighlight">\(s\)</span>
can be varied using unitary folding <a class="footnote-reference brackets" href="#giurgica2020digital" id="id4">4</a>.
Unitary folding works by noticing that any unitary <span class="math notranslate nohighlight">\(V\)</span> is equivalent to
<span class="math notranslate nohighlight">\(V V^{\dagger} V\)</span>. This type of transform can be applied to individual gates in the
circuit or to the whole circuit.
Let’s see how
folding works in code using Mitiq’s
<a class="reference external" href="https://mitiq.readthedocs.io/en/stable/apidoc.html#mitiq.zne.scaling.folding.fold_global">fold_global</a>
function, which folds globally by setting <span class="math notranslate nohighlight">\(V\)</span> to be the whole circuit.
We begin by making a copy of our above circuit using a
<a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="(in PennyLane v0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuantumTape</span></code></a>, which provides a low-level approach for circuit
construction in PennyLane.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">tape</span><span class="o">.</span><span class="n">QuantumTape</span></a><span class="p">()</span> <span class="k">as</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">circuit</span></a><span class="p">:</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.SimplifiedTwoDesign.html#pennylane.SimplifiedTwoDesign" title="pennylane.SimplifiedTwoDesign" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">template</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">))</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.adjoint.html#pennylane.adjoint" title="pennylane.adjoint" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">adjoint</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.SimplifiedTwoDesign.html#pennylane.SimplifiedTwoDesign" title="pennylane.SimplifiedTwoDesign" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">template</span></a><span class="p">)(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">))</span>
</pre></div>
</div>
<p>Don’t worry, in most situations you will not need to work with a PennyLane
<a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="(in PennyLane v0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuantumTape</span></code></a>! We are just dropping down to this
representation to gain a greater understanding of the Mitiq integration. Let’s see how folding
works for some typical scale factors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scale_factors</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">folded_circuits</span> <span class="o">=</span> <span class="p">[</span><span class="n">fold_global</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">circuit</span></a><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scale_factors</span><span class="p">]</span>

<span class="k">for</span> <span class="n">s</span><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">c</span></a> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scale_factors</span><span class="p">,</span> <span class="n">folded_circuits</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Globally-folded circuit with a scale factor of </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.drawer.tape_text.html#pennylane.drawer.tape_text" title="pennylane.drawer.tape_text" class="sphx-glr-backref-module-pennylane-drawer sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">drawer</span><span class="o">.</span><span class="n">tape_text</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">c</span></a><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">80</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Globally-folded circuit with a scale factor of 1:
0: ──RY(4.56)─╭●──RY(5.93)──RY(-5.93)────────────────────────────────────╭●
1: ──RY(3.60)─╰Z──RY(5.90)─╭●──────────RY(5.18)──RY(-5.18)─╭●──RY(-5.90)─╰Z
2: ──RY(4.05)─╭●──RY(3.32)─╰Z──────────RY(1.07)──RY(-1.07)─╰Z──RY(-3.32)─╭●
3: ──RY(3.51)─╰Z──RY(3.66)──RY(-3.66)────────────────────────────────────╰Z

───RY(-4.56)─┤
───RY(-3.60)─┤
───RY(-4.05)─┤
───RY(-3.51)─┤
Globally-folded circuit with a scale factor of 2:
0: ──RY(4.56)─╭●──RY(5.93)──RY(-5.93)────────────────────────────────────╭●
1: ──RY(3.60)─╰Z──RY(5.90)─╭●──────────RY(5.18)──RY(-5.18)─╭●──RY(-5.90)─╰Z
2: ──RY(4.05)─╭●──RY(3.32)─╰Z──────────RY(1.07)──RY(-1.07)─╰Z──RY(-3.32)─╭●
3: ──RY(3.51)─╰Z──RY(3.66)──RY(-3.66)────────────────────────────────────╰Z

───RY(-4.56)──RY(4.56)─╭●───────────────────────────────────────────────────────
───RY(-3.60)──RY(3.60)─╰Z──RY(5.90)─╭●──RY(5.18)──RY(-5.18)──RY(5.18)──RY(-5.18)
───RY(-4.05)──RY(4.05)─╭●──RY(3.32)─╰Z──RY(1.07)──RY(-1.07)──RY(1.07)──RY(-1.07)
───RY(-3.51)──RY(3.51)─╰Z───────────────────────────────────────────────────────

────────────────╭●──RY(-4.56)─┤
──╭●──RY(-5.90)─╰Z──RY(-3.60)─┤
──╰Z──RY(-3.32)─╭●──RY(-4.05)─┤
────────────────╰Z──RY(-3.51)─┤
Globally-folded circuit with a scale factor of 3:
0: ──RY(4.56)─╭●──RY(5.93)──RY(-5.93)────────────────────────────────────╭●
1: ──RY(3.60)─╰Z──RY(5.90)─╭●──────────RY(5.18)──RY(-5.18)─╭●──RY(-5.90)─╰Z
2: ──RY(4.05)─╭●──RY(3.32)─╰Z──────────RY(1.07)──RY(-1.07)─╰Z──RY(-3.32)─╭●
3: ──RY(3.51)─╰Z──RY(3.66)──RY(-3.66)────────────────────────────────────╰Z

───RY(-4.56)──RY(4.56)─╭●──RY(5.93)──RY(-5.93)────────────────────────
───RY(-3.60)──RY(3.60)─╰Z──RY(5.90)─╭●──────────RY(5.18)──RY(-5.18)─╭●
───RY(-4.05)──RY(4.05)─╭●──RY(3.32)─╰Z──────────RY(1.07)──RY(-1.07)─╰Z
───RY(-3.51)──RY(3.51)─╰Z──RY(3.66)──RY(-3.66)────────────────────────

─────────────╭●──RY(-4.56)──RY(4.56)─╭●──RY(5.93)──RY(-5.93)──────────
───RY(-5.90)─╰Z──RY(-3.60)──RY(3.60)─╰Z──RY(5.90)─╭●──────────RY(5.18)
───RY(-3.32)─╭●──RY(-4.05)──RY(4.05)─╭●──RY(3.32)─╰Z──────────RY(1.07)
─────────────╰Z──RY(-3.51)──RY(3.51)─╰Z──RY(3.66)──RY(-3.66)──────────

───────────────────────────╭●──RY(-4.56)─┤
───RY(-5.18)─╭●──RY(-5.90)─╰Z──RY(-3.60)─┤
───RY(-1.07)─╰Z──RY(-3.32)─╭●──RY(-4.05)─┤
───────────────────────────╰Z──RY(-3.51)─┤
</pre></div>
</div>
<p>Although these circuits are a bit deep, if you look carefully, you might be able to convince
yourself that they are all equivalent! In fact, since we have fixed our original circuit to be
of the form <span class="math notranslate nohighlight">\(U U^{\dagger}\)</span>, we get:</p>
<ul>
<li><p>When the scale factor is <span class="math notranslate nohighlight">\(s=1\)</span>, the resulting circuit is</p>
<div class="math notranslate nohighlight">
\[V = U^{\dagger} U = \mathbb{I}.\]</div>
<p>Hence, the <span class="math notranslate nohighlight">\(s=1\)</span> setting gives us the original unfolded circuit.</p>
</li>
<li><p>When <span class="math notranslate nohighlight">\(s=3\)</span>, the resulting circuit is</p>
<div class="math notranslate nohighlight">
\[V V^{\dagger} V = U^{\dagger} U U U^{\dagger} U^{\dagger} U = \mathbb{I}.\]</div>
<p>In other words, we fold the whole circuit once when <span class="math notranslate nohighlight">\(s=3\)</span>. Generally, whenever <span class="math notranslate nohighlight">\(s\)</span>
is an odd integer, we fold <span class="math notranslate nohighlight">\((s - 1) / 2\)</span> times.</p>
</li>
<li><p>The <span class="math notranslate nohighlight">\(s=2\)</span> setting is a bit more subtle. Now we apply folding only to the second half of
the circuit, which is in our case given by <span class="math notranslate nohighlight">\(U^{\dagger}\)</span>. The resulting partially-folded
circuit is</p>
<div class="math notranslate nohighlight">
\[(U^{\dagger} U U^{\dagger}) U = \mathbb{I}.\]</div>
<p>Visit Ref. <a class="footnote-reference brackets" href="#giurgica2020digital" id="id5">4</a> to gain a deeper understanding of unitary folding.</p>
</li>
</ul>
<p>If you’re still not convinced, we can evaluate the folded circuits on our noise-free device
<code class="docutils literal notranslate"><span class="pre">dev_ideal</span></code>. To do this, we’ll define an <code class="docutils literal notranslate"><span class="pre">executor</span></code> function that adds the
<a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliZ.html#pennylane.PauliZ" title="(in PennyLane v0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">PauliZ</span></code></a> measurement onto the first qubit of each input circuit and
then runs the circuits on a target device.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">executor</span><span class="p">(</span><span class="n">circuits</span><span class="p">,</span> <span class="n">dev</span><span class="o">=</span><span class="n">dev_noisy</span><span class="p">):</span>
    <span class="c1"># Support both a single circuit and multiple circuit execution</span>
    <span class="n">circuits</span> <span class="o">=</span> <span class="p">[</span><span class="n">circuits</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">circuits</span><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">tape</span><span class="o">.</span><span class="n">QuantumTape</span></a><span class="p">)</span> <span class="k">else</span> <span class="n">circuits</span>

    <span class="n">circuits_with_meas</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Loop through circuits and add on measurement</span>
    <span class="k">for</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">c</span></a> <span class="ow">in</span> <span class="n">circuits</span><span class="p">:</span>
        <span class="k">with</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">tape</span><span class="o">.</span><span class="n">QuantumTape</span></a><span class="p">()</span> <span class="k">as</span> <span class="n">circuit_with_meas</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape.operations" title="pennylane.tape.QuantumTape.operations" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-attribute"><span class="n">c</span><span class="o">.</span><span class="n">operations</span></a><span class="p">:</span>
                <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.apply.html#pennylane.apply" title="pennylane.apply" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">apply</span></a><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.expval.html#pennylane.expval" title="pennylane.expval" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">expval</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliZ.html#pennylane.PauliZ" title="pennylane.PauliZ" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliZ</span></a><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">circuits_with_meas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circuit_with_meas</span><span class="p">)</span>

    <span class="k">return</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.execute.html#pennylane.execute" title="pennylane.execute" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">execute</span></a><span class="p">(</span><span class="n">circuits_with_meas</span><span class="p">,</span> <span class="n">dev</span><span class="p">,</span> <span class="n">gradient_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>We need to do this step as part of the Mitiq integration with the low-level PennyLane
<a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="(in PennyLane v0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuantumTape</span></code></a>. You will not have to worry about these details
when using the main <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.transforms.mitigate_with_zne.html#pennylane.transforms.mitigate_with_zne" title="(in PennyLane v0.31)"><code class="xref py py-func docutils literal notranslate"><span class="pre">mitigate_with_zne</span></code></a> function we
encountered earlier.</p>
<p>Now, let’s execute these circuits:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">executor</span><span class="p">(</span><span class="n">folded_circuits</span><span class="p">,</span> <span class="n">dev</span><span class="o">=</span><span class="n">dev_ideal</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[tensor(1., requires_grad=True), tensor(1., requires_grad=True), tensor(1., requires_grad=True)]
</pre></div>
</div>
<p>By construction, these circuits are equivalent to the original and have the same output value of
<span class="math notranslate nohighlight">\(1\)</span>. On the other hand, each circuit has a different depth. If we expect each gate in a
circuit to contribute an amount of noise when running on NISQ hardware, we should see the
result of the executed circuit degrade with increased depth. This can be confirmed using the
<code class="docutils literal notranslate"><span class="pre">dev_noisy</span></code> device</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">executor</span><span class="p">(</span><span class="n">folded_circuits</span><span class="p">,</span> <span class="n">dev</span><span class="o">=</span><span class="n">dev_noisy</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[tensor(0.71729164, requires_grad=True), tensor(0.54368629, requires_grad=True), tensor(0.3777036, requires_grad=True)]
</pre></div>
</div>
<p>Although this degradation may seem undesirable, it is part of the standard recipe for ZNE error
mitigation: we have a family of equivalent circuits that experience a varying amount of noise
when executed on hardware, and we are able to control the amount of noise by varying the folding
scale factor <span class="math notranslate nohighlight">\(s\)</span> which determines the circuit depth. The final step is to extrapolate our
results back to <span class="math notranslate nohighlight">\(s=0\)</span>, providing us with an estimate of the noise-free result of the
circuit.</p>
<p>Performing extrapolation is a well-studied numeric method in mathematics, and Mitiq provides
access to some of the core approaches. Here we use the
<a class="reference external" href="https://en.wikipedia.org/wiki/Richardson_extrapolation">Richardson extrapolation</a> method with
the objective of finding a curve <span class="math notranslate nohighlight">\(y = f(x)\)</span> with some fixed <span class="math notranslate nohighlight">\((x, y)\)</span> values given by
the scale factors and corresponding circuit execution results, respectively. This can be performed
using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluate noise-scaled expectation values</span>
<span class="n">noisy_expectation_values</span> <span class="o">=</span> <span class="n">executor</span><span class="p">(</span><span class="n">folded_circuits</span><span class="p">,</span> <span class="n">dev</span><span class="o">=</span><span class="n">dev_noisy</span><span class="p">)</span>

<span class="c1"># Initialize extrapolation method</span>
<span class="n">fac</span> <span class="o">=</span> <span class="n">RichardsonFactory</span><span class="p">(</span><span class="n">scale_factors</span><span class="p">)</span>

<span class="c1"># Load data into extrapolation factory</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scale_factors</span><span class="p">,</span> <span class="n">noisy_expectation_values</span><span class="p">):</span>
    <span class="n">fac</span><span class="o">.</span><span class="n">push</span><span class="p">({</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">},</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="p">)</span>

<span class="c1"># Run extrapolation</span>
<span class="n">zero_noise</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">reduce</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ZNE result: </span><span class="si">{</span><span class="n">zero_noise</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>ZNE result: 0.8985196547410824
</pre></div>
</div>
<p>Let’s make a plot of the data and fitted extrapolation function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">fac</span><span class="o">.</span><span class="n">plot_fit</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_tutorial_error_mitigation_001.png" srcset="../_images/sphx_glr_tutorial_error_mitigation_001.png" alt="tutorial error mitigation" class = "sphx-glr-single-img"/><p>Since we are using the Richardson extrapolation method, the fitted function (dashed line)
corresponds to a polynomial interpolation of the measured data (blue points).</p>
<p>The zero-noise limit corresponds to the value of the extrapolation function evaluated at <cite>x=0</cite>.</p>
</div>
<div class="section" id="error-mitigation-in-pennylane">
<h2>Error mitigation in PennyLane<a class="headerlink" href="#error-mitigation-in-pennylane" title="Permalink to this headline">¶</a></h2>
<p>Now that we understand the ZNE method for error mitigation, we can provide a few more details on
how it can be performed using PennyLane. As we have seen, the
<a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.transforms.mitigate_with_zne.html#pennylane.transforms.mitigate_with_zne" title="(in PennyLane v0.31)"><code class="xref py py-func docutils literal notranslate"><span class="pre">mitigate_with_zne</span></code></a> function provides the main
entry point. This function is an example of a <span class="xref std std-doc">circuit transform,</span> and
it can be applied to pre-constructed QNodes as well as being used as a decorator when constructing
new QNodes. For example, suppose we have a <code class="docutils literal notranslate"><span class="pre">qnode</span></code> already defined. A mitigated QNode can be
created using:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mitigated_qnode</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.batch_transform.html#pennylane.batch_transform" title="pennylane.batch_transform" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mitigate_with_zne</span></a><span class="p">(</span><span class="n">scale_factors</span><span class="p">,</span> <span class="n">folding</span><span class="p">,</span> <span class="n">extrapolate</span><span class="p">)(</span><span class="n">qnode</span><span class="p">)</span>
</pre></div>
</div>
<p>When using <code class="docutils literal notranslate"><span class="pre">mitigate_with_zne</span></code>, we must specify the target scale factors as well as provide
functions for folding and extrapolation. Due to PennyLane’s integration with Mitiq, it is possible
to use the folding functions provided in the
<a class="reference external" href="https://mitiq.readthedocs.io/en/stable/apidoc.html#module-mitiq.zne.scaling.folding">mitiq.zne.scaling.folding</a>
module. For extrapolation, one can use the <code class="docutils literal notranslate"><span class="pre">extrapolate</span></code> method of the factories in the
<a class="reference external" href="https://mitiq.readthedocs.io/en/stable/apidoc.html#module-mitiq.zne.inference">mitiq.zne.inference</a>
module.</p>
<p>We now provide an example of how <code class="docutils literal notranslate"><span class="pre">mitigate_with_zne</span></code> can be used when constructing a QNode:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mitiq.zne.scaling</span> <span class="kn">import</span> <span class="n">fold_gates_at_random</span> <span class="k">as</span> <span class="n">folding</span>

<span class="n">extrapolate</span> <span class="o">=</span> <span class="n">RichardsonFactory</span><span class="o">.</span><span class="n">extrapolate</span>


<span class="nd">@mitigate_with_zne</span><span class="p">(</span><span class="n">scale_factors</span><span class="p">,</span> <span class="n">folding</span><span class="p">,</span> <span class="n">extrapolate</span><span class="p">,</span> <span class="n">reps_per_factor</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="nd">@qml</span><span class="o">.</span><span class="n">qnode</span><span class="p">(</span><span class="n">dev_noisy</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">mitigated_qnode</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a><span class="p">):</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.SimplifiedTwoDesign.html#pennylane.SimplifiedTwoDesign" title="pennylane.SimplifiedTwoDesign" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">template</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">))</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.adjoint.html#pennylane.adjoint" title="pennylane.adjoint" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">adjoint</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.SimplifiedTwoDesign.html#pennylane.SimplifiedTwoDesign" title="pennylane.SimplifiedTwoDesign" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">template</span></a><span class="p">)(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">))</span>
    <span class="k">return</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.expval.html#pennylane.expval" title="pennylane.expval" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">expval</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliZ.html#pennylane.PauliZ" title="pennylane.PauliZ" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliZ</span></a><span class="p">(</span><span class="mi">0</span><span class="p">))</span>


<span class="n">mitigated_qnode</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w1</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">w2</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>0.941479101720545
</pre></div>
</div>
<p>In the above, we can easily add in error mitigation using the <code class="docutils literal notranslate"><span class="pre">&#64;mitigate_with_zne</span></code> decorator. To
keep things interesting, we’ve swapped out our folding function to instead perform folding on
randomly-selected gates. Whenever the folding function is stochastic, there will not be a unique
folded circuit corresponding to a given scale factor. For example, the following three distinct
circuits are all folded with a scale factor of <span class="math notranslate nohighlight">\(s=1.1\)</span>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.drawer.tape_text.html#pennylane.drawer.tape_text" title="pennylane.drawer.tape_text" class="sphx-glr-backref-module-pennylane-drawer sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">drawer</span><span class="o">.</span><span class="n">tape_text</span></a><span class="p">(</span><span class="n">folding</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">circuit</span></a><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.1</span><span class="p">),</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">80</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>0: ──RY(4.56)─╭●──RY(5.93)──RY(-5.93)─────────────────────────────────────
1: ──RY(3.60)─╰Z──RY(5.90)──RY(-5.90)──RY(5.90)─╭●──RY(5.18)──RY(-5.18)─╭●
2: ──RY(4.05)─╭●──RY(3.32)──────────────────────╰Z──RY(1.07)──RY(-1.07)─╰Z
3: ──RY(3.51)─╰Z──RY(3.66)──RY(-3.66)─────────────────────────────────────

─────────────╭●──RY(-4.56)─┤
───RY(-5.90)─╰Z──RY(-3.60)─┤
───RY(-3.32)─╭●──RY(-4.05)─┤
─────────────╰Z──RY(-3.51)─┤
0: ──RY(4.56)─╭●──RY(5.93)──RY(-5.93)─────────────────────────────────────────
1: ──RY(3.60)─╰Z──RY(5.90)─╭●──────────RY(5.18)──RY(-5.18)─╭●─╭●─╭●──RY(-5.90)
2: ──RY(4.05)─╭●──RY(3.32)─╰Z──────────RY(1.07)──RY(-1.07)─╰Z─╰Z─╰Z──RY(-3.32)
3: ──RY(3.51)─╰Z──RY(3.66)──RY(-3.66)─────────────────────────────────────────

──╭●──RY(-4.56)─┤
──╰Z──RY(-3.60)─┤
──╭●──RY(-4.05)─┤
──╰Z──RY(-3.51)─┤
0: ──RY(4.56)─╭●──RY(5.93)──RY(-5.93)────────────────────────────────────╭●
1: ──RY(3.60)─╰Z──RY(5.90)─╭●──────────RY(5.18)──RY(-5.18)─╭●──RY(-5.90)─╰Z
2: ──RY(4.05)─╭●──RY(3.32)─╰Z──────────RY(1.07)──RY(-1.07)─╰Z──RY(-3.32)─╭●
3: ──RY(3.51)─╰Z──RY(3.66)──RY(-3.66)────────────────────────────────────╰Z

──╭●─────────╭●──RY(-4.56)─┤
──╰Z─────────╰Z──RY(-3.60)─┤
───RY(-4.05)───────────────┤
───RY(-3.51)───────────────┤
</pre></div>
</div>
<p>To accommodate for this randomness, we can perform multiple repetitions of random folding for a
fixed <span class="math notranslate nohighlight">\(s\)</span> and average over the execution results to generate the value <span class="math notranslate nohighlight">\(f(s)\)</span> used
for extrapolation. As shown above, the number of repetitions is controlled by setting the optional
<code class="docutils literal notranslate"><span class="pre">reps_per_factor</span></code> argument.</p>
<p>We conclude this section by highlighting the possibility of working directly with the core
functionality available in Mitiq. For example, the
<a class="reference external" href="https://mitiq.readthedocs.io/en/stable/apidoc.html#mitiq.zne.zne.execute_with_zne">execute_with_zne</a>
function is one of the central components of ZNE support in Mitiq and is compatible with circuits
constructed using a PennyLane <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="(in PennyLane v0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuantumTape</span></code></a>. Working directly
with Mitiq can be preferable when more flexibility is required in specifying the error mitigation
protocol. For example, the code below shows how an adaptive approach can be used to determine a
sequence of scale factors for extrapolation using Mitiq’s
<a class="reference external" href="https://mitiq.readthedocs.io/en/stable/apidoc.html#mitiq.zne.inference.AdaExpFactory">AdaExpFactory</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mitiq.zne</span> <span class="kn">import</span> <span class="n">execute_with_zne</span>
<span class="kn">from</span> <span class="nn">mitiq.zne.inference</span> <span class="kn">import</span> <span class="n">AdaExpFactory</span>

<span class="n">factory</span> <span class="o">=</span> <span class="n">AdaExpFactory</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">execute_with_zne</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">circuit</span></a><span class="p">,</span> <span class="n">executor</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">factory</span><span class="p">,</span> <span class="n">scale_noise</span><span class="o">=</span><span class="n">fold_global</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>0.958975947249419
</pre></div>
</div>
<p>Recall that <code class="docutils literal notranslate"><span class="pre">circuit</span></code> is a PennyLane <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="(in PennyLane v0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuantumTape</span></code></a> and that
it should not include measurements. We also use the <code class="docutils literal notranslate"><span class="pre">executor</span></code> function defined earlier that
adds on the target measurement and executes on a noisy device.</p>
</div>
<div class="section" id="mitigating-noisy-circuits-in-quantum-chemistry">
<h2>Mitigating noisy circuits in quantum chemistry<a class="headerlink" href="#mitigating-noisy-circuits-in-quantum-chemistry" title="Permalink to this headline">¶</a></h2>
<p>We’re now ready to apply our knowledge to a more practical problem in quantum chemistry:
calculating the potential energy surface of molecular hydrogen. This is achieved by finding the
ground state energy of <span class="math notranslate nohighlight">\(H_{2}\)</span> as we increase the bond length between the hydrogen atoms. As
shown in <a class="reference internal" href="tutorial_chemical_reactions.html"><span class="doc">this</span></a> tutorial, one approach to finding the ground
state energy is to calculate the corresponding qubit Hamiltonian and to fix an ansatz variational
quantum circuit that returns its expectation value. We can then vary the parameters of the
circuit to minimize the energy.</p>
<p>To find the potential energy surface of <span class="math notranslate nohighlight">\(H_{2}\)</span>, we must choose a range of interatomic
distances and calculate the qubit Hamiltonian corresponding to each distance. We then optimize the
variational circuit with a new set of parameters for each Hamiltonian and plot the resulting
energies for each distance. In this demo, we compare the potential energy surface reconstructed
when the optimized variational circuits are run on ideal, noisy, and noise-mitigated devices.</p>
<p>Instead of modifying the <a class="reference external" href="https://docs.pennylane.ai/en/stable/code/api/pennylane.devices.default_mixed.html#module-pennylane.devices.default_mixed" title="(in PennyLane v0.31)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">default.mixed</span></code></a> device to add
simple noise as we do above, let’s choose a noise model that is a little closer to physical
hardware. Suppose we want to simulate the <code class="docutils literal notranslate"><span class="pre">ibmq_lima</span></code> hardware device available on IBMQ. We
can load a noise model that represents this device using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit.test.mock</span> <span class="kn">import</span> <span class="n">FakeLima</span>
<span class="kn">from</span> <span class="nn">qiskit.providers.aer.noise</span> <span class="kn">import</span> <span class="n">NoiseModel</span>

<span class="n">backend</span> <span class="o">=</span> <span class="n">FakeLima</span><span class="p">()</span>
<span class="n">noise_model</span> <span class="o">=</span> <span class="n">NoiseModel</span><span class="o">.</span><span class="n">from_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/home/runner/work/qml/qml/demonstrations/tutorial_error_mitigation.py:432: DeprecationWarning: The module &#39;qiskit.test.mock&#39; is deprecated since Qiskit Terra 0.21.0, and will be removed 3 months or more later. Instead, you should import the desired object directly &#39;qiskit.providers.fake_provider&#39;.
  from qiskit.test.mock import FakeLima
</pre></div>
</div>
<p>We can then set up our ideal device and the noisy simulator of <code class="docutils literal notranslate"><span class="pre">ibmq_lima</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n_wires</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">dev_ideal</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.device.html#pennylane.device" title="pennylane.device" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">device</span></a><span class="p">(</span><span class="s2">&quot;default.qubit&quot;</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="n">n_wires</span><span class="p">)</span>
<span class="n">dev_noisy</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.device.html#pennylane.device" title="pennylane.device" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">device</span></a><span class="p">(</span>
    <span class="s2">&quot;qiskit.aer&quot;</span><span class="p">,</span>
    <span class="n">wires</span><span class="o">=</span><span class="n">n_wires</span><span class="p">,</span>
    <span class="n">noise_model</span><span class="o">=</span><span class="n">noise_model</span><span class="p">,</span>
    <span class="n">optimization_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">shots</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note the use of the <code class="docutils literal notranslate"><span class="pre">optimization_level=0</span></code> argument when loading the noisy device. This prevents
the <code class="docutils literal notranslate"><span class="pre">qiskit.aer</span></code> transpiler from performing a pre-execution circuit optimization.</p>
<p>To simplify this demo, we will load pre-trained parameters for our variational circuit.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">params</span></a> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;error_mitigation/params.npy&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>These parameters can be downloaded by clicking
<a class="reference download internal" download="" href="../_downloads/bc0731caabc1d9ec29826e00faab5139/params.npy"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>. We are now ready to set up the
variational circuit and run on the ideal and noisy devices.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pennylane</span> <span class="kn">import</span> <span class="n">qchem</span>

<span class="c1"># Describe quantum chemistry problem</span>
<span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">]</span>
<a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">distances</span></a> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>

<span class="n">ideal_energies</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">noisy_energies</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">r</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">phi</span></a> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">distances</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">params</span></a><span class="p">):</span>
    <span class="c1"># Assume atoms lie on the Z axis</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">r</span></a><span class="p">])</span>

    <span class="c1"># Load qubit Hamiltonian</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian" title="pennylane.Hamiltonian" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H</span></a><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.qchem.molecular_hamiltonian.html#pennylane.qchem.molecular_hamiltonian" title="pennylane.qchem.molecular_hamiltonian" class="sphx-glr-backref-module-pennylane-qchem sphx-glr-backref-type-py-function"><span class="n">qchem</span><span class="o">.</span><span class="n">molecular_hamiltonian</span></a><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">)</span>

    <span class="c1"># Define ansatz circuit</span>
    <span class="k">def</span> <span class="nf">qchem_circuit</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">phi</span></a><span class="p">):</span>
        <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliX.html#pennylane.PauliX" title="pennylane.PauliX" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliX</span></a><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliX.html#pennylane.PauliX" title="pennylane.PauliX" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliX</span></a><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.DoubleExcitation.html#pennylane.DoubleExcitation" title="pennylane.DoubleExcitation" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">DoubleExcitation</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">phi</span></a><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">))</span>
        <span class="k">return</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.expval.html#pennylane.expval" title="pennylane.expval" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">expval</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian" title="pennylane.Hamiltonian" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H</span></a><span class="p">)</span>

    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ideal_energy</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">QNode</span></a><span class="p">(</span><span class="n">qchem_circuit</span><span class="p">,</span> <span class="n">dev_ideal</span><span class="p">)</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">noisy_energy</span></a> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">QNode</span></a><span class="p">(</span><span class="n">qchem_circuit</span><span class="p">,</span> <span class="n">dev_noisy</span><span class="p">)</span>

    <span class="n">ideal_energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ideal_energy</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">phi</span></a><span class="p">))</span>
    <span class="n">noisy_energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.QNode.html#pennylane.QNode" title="pennylane.QNode" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">noisy_energy</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">phi</span></a><span class="p">))</span>
</pre></div>
</div>
<p>An error-mitigated version of the potential energy surface can also be calculated using the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mitig_energies</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">r</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">phi</span></a> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">distances</span></a><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">params</span></a><span class="p">):</span>
    <span class="c1"># Assume atoms lie on the Z axis</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">r</span></a><span class="p">])</span>

    <span class="c1"># Load qubit Hamiltonian</span>
    <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian" title="pennylane.Hamiltonian" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H</span></a><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.qchem.molecular_hamiltonian.html#pennylane.qchem.molecular_hamiltonian" title="pennylane.qchem.molecular_hamiltonian" class="sphx-glr-backref-module-pennylane-qchem sphx-glr-backref-type-py-function"><span class="n">qchem</span><span class="o">.</span><span class="n">molecular_hamiltonian</span></a><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">coordinates</span></a><span class="p">)</span>

    <span class="c1"># Define ansatz circuit</span>
    <span class="k">with</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">tape</span><span class="o">.</span><span class="n">QuantumTape</span></a><span class="p">()</span> <span class="k">as</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">circuit</span></a><span class="p">:</span>
        <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliX.html#pennylane.PauliX" title="pennylane.PauliX" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliX</span></a><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.PauliX.html#pennylane.PauliX" title="pennylane.PauliX" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">PauliX</span></a><span class="p">(</span><span class="n">wires</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.DoubleExcitation.html#pennylane.DoubleExcitation" title="pennylane.DoubleExcitation" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">DoubleExcitation</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.numpy.tensor.html#pennylane.numpy.tensor" title="pennylane.numpy.tensor" class="sphx-glr-backref-module-pennylane-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">phi</span></a><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">n_wires</span><span class="p">))</span>

    <span class="c1"># Define custom executor that expands Hamiltonian measurement</span>
    <span class="c1"># into a linear combination of tensor products of Pauli</span>
    <span class="c1"># operators.</span>
    <span class="k">def</span> <span class="nf">executor</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">circuit</span></a><span class="p">):</span>

        <span class="c1"># Add Hamiltonian measurement to circuit</span>
        <span class="k">with</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class"><span class="n">qml</span><span class="o">.</span><span class="n">tape</span><span class="o">.</span><span class="n">QuantumTape</span></a><span class="p">()</span> <span class="k">as</span> <span class="n">circuit_with_meas</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape.operations" title="pennylane.tape.QuantumTape.operations" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-attribute"><span class="n">circuit</span><span class="o">.</span><span class="n">operations</span></a><span class="p">:</span>
                <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.apply.html#pennylane.apply" title="pennylane.apply" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">apply</span></a><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.expval.html#pennylane.expval" title="pennylane.expval" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">expval</span></a><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.Hamiltonian.html#pennylane.Hamiltonian" title="pennylane.Hamiltonian" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H</span></a><span class="p">)</span>

        <span class="c1"># Expand Hamiltonian measurement into tensor product of</span>
        <span class="c1"># of Pauli operators. We get a list of circuits to execute</span>
        <span class="c1"># and a postprocessing function to combine the results into</span>
        <span class="c1"># a single number.</span>
        <span class="n">circuits</span><span class="p">,</span> <span class="n">postproc</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.transforms.hamiltonian_expand.html#pennylane.transforms.hamiltonian_expand" title="pennylane.transforms.hamiltonian_expand" class="sphx-glr-backref-module-pennylane-transforms sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">hamiltonian_expand</span></a><span class="p">(</span>
            <span class="n">circuit_with_meas</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">circuits_executed</span> <span class="o">=</span> <a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.execute.html#pennylane.execute" title="pennylane.execute" class="sphx-glr-backref-module-pennylane sphx-glr-backref-type-py-function"><span class="n">qml</span><span class="o">.</span><span class="n">execute</span></a><span class="p">(</span><span class="n">circuits</span><span class="p">,</span> <span class="n">dev_noisy</span><span class="p">,</span> <span class="n">gradient_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">postproc</span><span class="p">(</span><span class="n">circuits_executed</span><span class="p">)</span>

    <span class="n">mitig_energy</span> <span class="o">=</span> <span class="n">execute_with_zne</span><span class="p">(</span><a href="https://docs.pennylane.ai/en/stable/code/api/pennylane.tape.QuantumTape.html#pennylane.tape.QuantumTape" title="pennylane.tape.QuantumTape" class="sphx-glr-backref-module-pennylane-tape sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">circuit</span></a><span class="p">,</span> <span class="n">executor</span><span class="p">,</span> <span class="n">scale_noise</span><span class="o">=</span><span class="n">fold_global</span><span class="p">)</span>
    <span class="n">mitig_energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mitig_energy</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we can plot the three surfaces and compare:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ideal_energies</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ideal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">noisy_energies</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;noisy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mitig_energies</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;mitigated&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Bond length (Bohr)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total energy (Hartree)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_tutorial_error_mitigation_002.png" srcset="../_images/sphx_glr_tutorial_error_mitigation_002.png" alt="tutorial error mitigation" class = "sphx-glr-single-img"/><p>Great, error mitigation has allowed us to more closely approximate the ideal noise-free curve!</p>
<p>We have seen in this demo how easy error mitigation can be in PennyLane when using Mitiq as a
backend. As well as understanding the basics of the ZNE method, we have also seen how mitigation
can be used to uplift the performance of noisy devices for practical tasks like quantum chemistry.
On the other hand, we’ve only just started to scratch the surface of what can be done with error
mitigation. We can explore applying the ZNE method to other use cases, or even try out other
mitigation methods like
<a class="reference external" href="https://mitiq.readthedocs.io/en/stable/examples/pec-tutorial.html">probabilistic error cancellation</a>.
Let us know where your adventures take you, and the Mitiq and PennyLane teams will keep working to
help make error mitigation as easy as possible!</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="proctor2020measuring"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>T. Proctor, K. Rudinger, K. Young, E. Nielsen, R. Blume-Kohout
<a class="reference external" href="https://arxiv.org/abs/2008.11294">“Measuring the Capabilities of Quantum Computers”</a>,
arXiv:2008.11294 (2020).</p>
</dd>
<dt class="label" id="temme2017error"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>K. Temme, S. Bravyi, J. M. Gambetta
<a class="reference external" href="https://journals.aps.org/prl/abstract/10.1103/PhysRevLett.119.180509">“Error Mitigation for Short-Depth Quantum Circuits”</a>,
Phys. Rev. Lett. 119, 180509 (2017).</p>
</dd>
<dt class="label" id="li2017efficient"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>Y. Li, S. C. Benjamin
<a class="reference external" href="https://journals.aps.org/prx/abstract/10.1103/PhysRevX.7.021050">“Efficient Variational Quantum Simulator Incorporating Active Error Minimization”</a>,
Phys. Rev. X 7, 021050 (2017).</p>
</dd>
<dt class="label" id="giurgica2020digital"><span class="brackets">4</span><span class="fn-backref">(<a href="#id4">1</a>,<a href="#id5">2</a>)</span></dt>
<dd><p>T. Giurgica-Tiron, Y. Hindy, R. LaRose, A. Mari, W. J. Zeng
<a class="reference external" href="https://ieeexplore.ieee.org/document/9259940">“Digital zero noise extrapolation for quantum error mitigation”</a>,
IEEE International Conference on Quantum Computing and Engineering (2020).</p>
</dd>
</dl>
</div>
<div class="section" id="about-the-authors">
<h2>About the authors<a class="headerlink" href="#about-the-authors" title="Permalink to this headline">¶</a></h2>
<div class="bio" >
    <div class="photo" >
        <img class="photo__img" src="../_static/authors/thomas_bromley.png" alt="Thomas Bromley" >
    </div>
    <div class="bio-text">
        <h4 class="bio-text__author-name">Thomas Bromley</h4>
        <p class="bio-text__author-description">Thomas is a quantum scientist working at Xanadu. His work is focused on developing software to execute quantum algorithms on simulators and hardware.</p>
    </div>
</div><div class="bio" >
    <div class="photo" >
        <img class="photo__img" src="../_static/authors/andrea_mari.jpeg" alt="Andrea Mari" >
    </div>
    <div class="bio-text">
        <h4 class="bio-text__author-name">Andrea Mari</h4>
        <p class="bio-text__author-description">Andrea obtained a PhD in quantum information theory from the University of Potsdam (Germany). He worked as a postdoc at Scuola Normale Superiore (Pisa, Italy) and as a remote researcher at Xanadu. Since 2020 is a Member of Technical Staff at Unitary Fund.</p>
    </div>
</div><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 2 minutes  2.418 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-demos-tutorial-error-mitigation-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/b7abba86c39e6737ead1f0cc1cab5739/tutorial_error_mitigation.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">tutorial_error_mitigation.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/43e245add80871dbf65c040936451977/tutorial_error_mitigation.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">tutorial_error_mitigation.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


    <script type="text/javascript">
        // This script ensures that the active navbar entry switches
        // from 'QML' to 'Demos' for any webpage within the demos/ directory,
        // or for any of the demonstration landing pages
        // (e.g., demos_optimization).
        var pagename = document.location.href.match(/[^\/]+$/)[0];
        var dir = document.URL.substr(0,document.URL.lastIndexOf('/')).match(/[^\/]+$/)[0];

        if (pagename.includes("demos") || pagename.includes("demonstrations") || dir.includes("demos")) {

            $(".nav-item.active").removeClass("active");
            var demos_link = $('.navbar-nav a').filter(function(index) { return $(this).text() === "Demos"; })[0]
            $(demos_link).parent().addClass("active");
        }
    </script>

              <div id="bottom-dl" class="xanadu-call-to-action-links">
                <div id="tutorial-type">demos/tutorial_error_mitigation</div>
                <div class="download-python-link">
                  <i class="fab fa-python"></i>&nbsp;
                  <div class="call-to-action-desktop-view">Download Python script</div>
                </div>
                <div class="download-notebook-link">
                  <i class="fas fa-download"></i>&nbsp;
                  <div class="call-to-action-desktop-view">Download Notebook</div>
                </div>
                <div class="github-view-link">
                  <i class="fab fa-github"></i>&nbsp;
                  <div class="call-to-action-desktop-view">View on GitHub</div>
                </div>
              </div>

            </div>
            
          </div>
        
<div class="localtoc-container nano has-scrollbar">
  <div class="nano-content">
    <div id="localtoc">
        
          <h3>Contents</h3>
          <!-- Display the ToC for the current document if it is not empty. -->
          <ul class='current'>
<li class='current'><a class="reference internal" href="#">Error mitigation with Mitiq and PennyLane</a><ul class='current'>
<li class='current'><a class="reference internal" href="#mitigating-noise-in-a-simple-circuit">Mitigating noise in a simple circuit</a></li>
<li class='current'><a class="reference internal" href="#understanding-error-mitigation">Understanding error mitigation</a></li>
<li class='current'><a class="reference internal" href="#error-mitigation-in-pennylane">Error mitigation in PennyLane</a></li>
<li class='current'><a class="reference internal" href="#mitigating-noisy-circuits-in-quantum-chemistry">Mitigating noisy circuits in quantum chemistry</a></li>
<li class='current'><a class="reference internal" href="#references">References</a></li>
<li class='current'><a class="reference internal" href="#about-the-authors">About the authors</a></li>
</ul>
</li>
</ul>

        
    </div>

    <div class="xanadu-call-to-action-links">
        <h3>Downloads</h3>
        <div id="tutorial-type">demos/tutorial_error_mitigation</div>
        <div class="download-python-link">
            <i class="fab fa-python"></i>&nbsp;
            <div class="call-to-action-desktop-view">Download Python script</div>
        </div>
        <div class="download-notebook-link">
            <i class="fas fa-download"></i>&nbsp;
            <div class="call-to-action-desktop-view">Download Notebook</div>
        </div>
        <div class="github-view-link">
            <i class="fab fa-github"></i>&nbsp;
            <div class="call-to-action-desktop-view">View on GitHub</div>
        </div>
    </div>
    <div id="related-tutorials" class="mt-4">
      <h3> Related</h3>
    </div>
  </div>
</div>


    
          <div class="up-button">
            
              
                <a href="../demos_quantum-computing.html"><i class="fas fa-angle-double-left"></i></a>
              
            
          </div>

          <div class="clearfix"></div>
        </div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tutorial_sc_qubits.html" title="Quantum computing with superconducting qubits"
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial_trapped_ions.html" title="Trapped ion quantum computers"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">PennyLane  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../demonstrations.html" >Demos</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../demos_quantum-computing.html" >Quantum Computing</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Error mitigation with Mitiq and PennyLane</a></li> 
      </ul>
    </div>
  <script type="text/javascript">
    $("#mobile-toggle").click(function () {
      $("#left-column").slideToggle("slow");
    });
  </script>

  <!-- jQuery -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <!-- MathJax -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.10/js/mdb.min.js"></script>
  <!-- NanoScroller -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.nanoscroller/0.8.7/javascripts/jquery.nanoscroller.min.js"></script>
  <!-- Syntax Highlighting -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
  <script type="text/javascript">hljs.initHighlightingOnLoad();</script>

  <script type="text/javascript">
    $("a.reference.internal").each(function(){
      var link = $(this).attr("href");

      var hash = link.split("#")[1];
      var page = link.split("#")[0].split("/").slice(-1)[0].replace(".html", "");

      if (hash == page) {
        $(this).attr("href", link.split("#")[0]);
      }
    });

    $(".document > .section").removeClass("section");
    $("h1 ~ .section").removeClass("section");
    $(".localtoc-container .nano-content").css("height", $("#content").height());
    $(".localtoc-container").css("height", $("#content").height());
    $(".nano").nanoScroller();
  </script>

  <script type="text/javascript">
      $(window).scroll(function(){
        var scrollBottom = $(document).height() - $(window).height() - $(window).scrollTop();
        if (scrollBottom < 342) {
          $(".localtoc-container").css("height", "calc(100% - " + (342 - scrollBottom) + "px)");
          $(".localtoc-container .nano-content").css("height", "calc(100% - 119px)");
        }
      });
  </script>

  <script type="text/javascript">
    if ($(".current").length) {
      var target = $(".current")[0]
      var rect = target.getBoundingClientRect();
      if (rect.bottom > window.innerHeight) {
          $(".nano").nanoScroller({ scrollTo: $(".current") });
      } else {
          $(".nano").nanoScroller({ scrollTop: 0 });
      }
    }
    $(document).ready(function () {
        $(".css-transitions-only-after-page-load").each(function (index, element) {
            setTimeout(function () { $(element).removeClass("css-transitions-only-after-page-load") }, 10);
        });
        if (window.location.hash) {
          var target = $("[id='" + window.location.hash.substr(1) + "']");
          if (target.closest(".collapse").length) {
            target.closest(".collapse").addClass("show");
            target.closest(".collapse").prev().find(".rotate").addClass("up");
          }
        }
    });
  </script>

    <script type="text/javascript">
    var downloadNote = $(".sphx-glr-download-link-note.admonition.note");
    if (downloadNote.length >= 1) {
      var tutorialUrlArray = $("#tutorial-type").text().split('/');

      if (tutorialUrlArray[0] == "demos") {
        tutorialUrlArray[0] = "demonstrations";
      }

      var githubLink = "https://github.com/" + "PennyLaneAI/qml" + "/blob/master/" + tutorialUrlArray.join("/") + ".py",
          pythonLink = $(".sphx-glr-download .reference.download")[0].href,
          notebookLink = $(".sphx-glr-download .reference.download")[1].href;

      $(".download-python-link").wrap("<a href=" + pythonLink + " data-behavior='call-to-action-event' data-response='Download Python script' download target='_blank'/>");
      $(".download-notebook-link").wrap("<a href=" + notebookLink + " data-behavior='call-to-action-event' data-response='Download Notebook' download target='_blank'/>");
      $(".github-view-link").wrap("<a href=" + githubLink + " data-behavior='call-to-action-event' data-response='View on Github' target='_blank'/>");
      $("#right-column").addClass("page-shadow");
    } else {
      $(".xanadu-call-to-action-links").hide();
      $("#bottom-dl").attr('style','display: none !important');
    }
    </script>

    <script type="text/javascript">
      function makeUL(urls, text) {
          var list = document.createElement('ul');

          for (var i = 0; i < urls.length; i++) {
              var item = document.createElement('li');
              var a = document.createElement('a');
              var linkText = document.createTextNode(text[i]);
              a.appendChild(linkText);
              a.href = urls[i];
              item.appendChild(a);
              list.appendChild(item);
          }
          return list;
      }

      if (typeof related_tutorials !== 'undefined') {
          document.getElementById('related-tutorials').appendChild(makeUL(related_tutorials, related_tutorials_titles));
          $("#related-tutorials ul li a").append(' <i class="fas fa-angle-double-right" style="font-size: smaller;"></i>')
          $("#related-tutorials").show();

    } else {
          $("#related-tutorials").hide();
    }
    </script>

  <!-- Account for MathJax when navigating to anchor tags. -->
  <script type="text/javascript">
    function scrollToElement(e) {
      // Scrolls to the given element, taking into account the navbar.
      MathJax.Hub.Queue(function() {
        // The following MUST be done asynchronously to take effect.
        setTimeout(function() {
          const navbar = document.querySelector("nav.navbar");
          const navbarHeight = navbar ? navbar.offsetHeight : 0;
          const scrollToY = e.offsetTop + e.offsetParent.offsetTop - navbarHeight;
          window.scrollTo(0, scrollToY);
        }, 0);
      });
    }

    function scrollToFragment(fragment) {
      // Scrolls to the position of the given URL fragment (which includes the "#").
      const elementID = fragment.replace(".", "\\.");
      if (elementID !== "") {
        const element = document.querySelector(elementID);
        if (element !== null) {
          scrollToElement(element);
        }
      }
    }

    $(document).ready(() => {
      scrollToFragment(window.location.hash);
      window.addEventListener("popstate", (_) => scrollToFragment(document.location.hash), false);
    });
  </script>

  <!-- Hide the rendering of :orphan: metadata. -->
  <script type="text/javascript">
    $(document).ready(() => {
      const elements = document.getElementsByClassName("field-odd");
      for (const element of elements) {
          if (element.innerHTML.trim() === "orphan") {
            element.style.display = "none";
          }
      }
    });
  </script>

  <script type="text/javascript">
    jQuery.noConflict(true);
  </script>

  

<footer class="page-footer text-md-left pt-4">

  <hr class="pb-0 mb-0">
  <div class="container-fluid">
    <div class="row justify-content-md-center">

      
      <!-- About -->
      <div class="col-md-4">
        <h5 class="mb-1 footer-heading">PennyLane</h5>
        <hr width=100px class="d-inline-block mt-0 mb-1 accent-4">
        <p>        PennyLane is an open-source software framework for quantum
        machine learning, quantum chemistry, and quantum computing, 
        with the ability to run on all hardware.
        Maintained with ❤️ by Xanadu.
        </p>
      </div>
      

      <!-- Links -->
      
      <div class="col-md-2 col-4">
        <h5 class="mb-1 footer-heading">PennyLane</h5>
        <hr width=100px class="d-inline-block mt-0 mb-1 accent-4">
        <ul class="list-unstyled">
          
          <li><a href="https://pennylane.ai/">Home</a></li>
          
          <li><a href="https://pennylane.ai/qml">Learn</a></li>
          
          <li><a href="https://pennylane.ai/qml/demonstrations.html">Demonstrations</a></li>
          
          <li><a href="https://docs.pennylane.ai/">Documentation</a></li>
          
          <li><a href="https://github.com/PennyLaneAI/pennylane">GitHub</a></li>
          
          <li><a href="https://twitter.com/pennylaneai">Twitter</a></li>
          
          <li><a href="https://pennylane.ai/blog">Blog</a></li>
          
        </ul>
      </div>
      
      <div class="col-md-2 col-4">
        <h5 class="mb-1 footer-heading">Xanadu</h5>
        <hr width=100px class="d-inline-block mt-0 mb-1 accent-4">
        <ul class="list-unstyled">
          
          <li><a href="https://xanadu.ai/">Home</a></li>
          
          <li><a href="https://xanadu.ai/about/">About</a></li>
          
          <li><a href="https://xanadu.ai/photonics">Hardware</a></li>
          
          <li><a href="https://xanadu.ai/careers/">Careers</a></li>
          
          <li><a href="https://cloud.xanadu.ai">Cloud</a></li>
          
          <li><a href="https://discuss.pennylane.ai/">Forum</a></li>
          
          <li><a href="https://xanadu.ai/blog">Blog</a></li>
          
        </ul>
      </div>
      

    </div>
  </div>
  <hr>

  <!-- Social -->
  <div class="social-section text-center">
      <ul class="list-unstyled list-inline mb-0">
          
          <li class="list-inline-item"><a class="btn-git" href="https://twitter.com/PennyLaneAI"><i class="fab fa-twitter"> </i></a></li>
          
          <li class="list-inline-item"><a class="btn-git" href="https://github.com/PennyLaneAI/pennylane"><i class="fab fa-github"> </i></a></li>
          
          <li class="list-inline-item"><a class="btn-git" href="https://linkedin.com/company/xanaduai/"><i class="fab fa-linkedin-in"> </i></a></li>
          
          <li class="list-inline-item"><a class="btn-git" href="https://discuss.pennylane.ai"><i class="fab fa-discourse"> </i></a></li>
          
          <li class="list-inline-item"><a class="btn-git" href="https://xanadu-quantum.slack.com/join/shared_invite/zt-nkwn25v9-H4hituCb_PUj4idG0MhSug#/shared-invite/email"><i class="fab fa-slack"> </i></a></li>
          
          <li class="list-inline-item"><a class="btn-git" href="https://pennylane.ai/blog/"><i class="fas fa-rss"> </i></a></li>
          
      </ul>
      
        
          <a href="https://xanadu.us17.list-manage.com/subscribe?u=725f07a1d1a4337416c3129fd&id=294b062630" style="font-size: initial;">
            Stay updated with our newsletter
          </a>
        
      
  </div>

  <!-- Copyright -->
  <div class="footer-copyright py-3 mt-0 text-center">
      <div class="container-fluid">
            Copyright &copy; 2022, Xanadu Quantum Technologies, Inc.

        
          <br>
          TensorFlow, the TensorFlow logo, and any related marks are trademarks of Google Inc.
        
      </div>
  </div>
</footer>
  </body>
</html>